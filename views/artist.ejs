<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Home Page</title>

    <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" type="text/css" />
    <link rel="stylesheet" href="/vendor/border-box.css" type="text/css" />
    <link rel="stylesheet" href="/styles/layout.css" type="text/css" />

    <script type="text/javascript" src="/vendor/jquery-3.0.0.js"></script>
    <script type="text/javascript" src="/scripts/app.js"></script>
  </head>

  <body>
    <h1 id="token"></h1>
    <p id="p1"></p>
    <button id="btn">Get Glass Animals</button>
    <img src="#" id="img1">
    <div id="play"></div>

    <script type="text/javascript">
      document.getElementById("token").innerHTML = "whoa";

      function getHashParams() {
        var hashParams = {};
        var e, r = /([^&;=]+)=?([^&;]*)/g,
        q = window.location.hash.substring(1);
        while ( e = r.exec(q)) {
          hashParams[e[1]] = decodeURIComponent(e[2]);
        }
        return hashParams;
      }

      let hashParams = {};

      if (window.location.hash) {
        hashParams = getHashParams();
        document.querySelector("#p1").innerHTML = hashParams.access_token
      }

      let artist = {}

      document.querySelector("#btn").onclick = () => {
        $.ajax({
          url: "https://api.spotify.com/v1/search?q=glass%20animals&type=artist",
          type: "GET",
          headers: {
            "Authorization": "Bearer " + hashParams.access_token
          }
        }).then(resSearch => {
          let a = resSearch.artists.items[0];
          artist.name = a.name;
          artist.href = a.href
          artist.id = a.id
          artist.image640 = a.images[0].url

          let albumUrl = `https://api.spotify.com/v1/artists/${a.id}/albums?market=ES&limit=2`

          $.ajax({
            url: albumUrl,
            type: "GET",
            headers: {
              "Authorization": "Bearer " + hashParams.access_token
            }
          }).then(resAlbums => {
            let a = resAlbums
            console.log(a)
            document.querySelector("#p1").innerHTML = `
                  name: ${artist.name}
                  link: ${artist.href}
                  id: ${artist.id}
                `
            document.querySelector("#img1").src = artist.image640
            document.querySelector("#play").innerHTML = `<iframe src="https://open.spotify.com/embed/album/${a.items[0].id}" width="300" height="200" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>`

          })
        })
      }

    </script>
  </body>
</html>
