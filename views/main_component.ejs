<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Home Page</title>

    <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" type="text/css" />
    <link rel="stylesheet" href="/vendor/border-box.css" type="text/css" />
    <link rel="stylesheet" href="/styles/layout.css" type="text/css" />
    <link rel="stylesheet" href="/styles/artist.css" type="text/css" />
    <link rel="stylesheet" href="/styles/main_component.css" type="text/css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <script type="text/javascript" src="/vendor/jquery-3.0.0.js"></script>
    <script type="text/javascript" src="/scripts/app.js"></script>
  </head>

  <body>
    <% include partials/__nav %>

    <div id="mainArea">
      <section id="listArea">

        <h1>listArea</h1>
        <input id="searchArtist" type="text" placeholder="enter artist"></input>
        <button id="btn">Get Artist</button>
      </section>


      <section id="artistArea">
        <div id="artists"></div>
      </section>


      <section id="mapArea">

        <h1>mapArea</h1>
      </section>

    </main>

    <script type="text/javascript">
      function getHashParams() {
        var hashParams = {};
        var e, r = /([^&;=]+)=?([^&;]*)/g,
        q = window.location.hash.substring(1);
        while ( e = r.exec(q)) {
          hashParams[e[1]] = decodeURIComponent(e[2]);
        }
        return hashParams;
      }

      let hashParams = {};

      if (window.location.hash) {
        hashParams = getHashParams();
      }

      let artist = {}

      document.querySelector("#btn").onclick = () => {
        let searchText = document.querySelector("#searchArtist").value
        $.ajax({
          url: "https://api.spotify.com/v1/search?q=" + searchText + "&type=artist",
          type: "GET",
          headers: {
            "Authorization": "Bearer " + hashParams.access_token
          }
        }).then(resSearch => {
          let a = resSearch.artists.items[0];
          artist.name = a.name;
          artist.href = a.href
          artist.id = a.id
          artist.image640 = a.images[0].url

          let albumUrl = `https://api.spotify.com/v1/artists/${a.id}/albums?market=ES&limit=2`

          $.ajax({
            url: albumUrl,
            type: "GET",
            headers: {
              "Authorization": "Bearer " + hashParams.access_token
            }
          }).then(resAlbums => {
            let a = resAlbums

            $("#artistArea").css({ 'display' : 'block', 'flex' : 1 });
            document.querySelector("#artists").innerHTML += `
              <div class='artist_container'>
                <img src="${artist.image640}">
                <div class="artist_info">
                  <h1 class='artist_name'>${artist.name}</h1>
                  <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Quo eius voluptates nulla recusandae eveniet quaerat ducimus? Mollitia sequi delectus eveniet, vel placeat autem dicta eligendi repudiandae labore laboriosam aut quod, nemo eaque quibusdam odit, rem ipsa. Obcaecati, ratione iure numquam quam aut nobis vel cum itaque reiciendis debitis dolore, inventore quod vero. Vel fugiat neque voluptates nobis officiis sapiente earum!</p>
                  <iframe src="https://open.spotify.com/embed/album/${a.items[0].id}" width="300" height="200" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
                </div>
              </div>
              `
            // console.log(a)
            // document.querySelector("#p1").innerHTML = `
            //       name: ${artist.name}
            //       link: ${artist.href}
            //       id: ${artist.id}
            //     `
            // document.querySelector("#img1").src = artist.image640
            // document.querySelector("#play").innerHTML = `<iframe src="https://open.spotify.com/embed/album/${a.items[0].id}" width="300" height="200" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>`

          })
        })
      }

    </script>
  </body>
</html>
